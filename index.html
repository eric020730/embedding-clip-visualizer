<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Embedding & CLIP è¦–è¦ºåŒ– - 3D äº’å‹•æ•™å­¸</title>
    <meta name="description" content="ç”¨ 3D ç©ºé–“ç†è§£ AI çš„ Embedding å’Œ CLIP åœ–åƒæª¢ç´¢æŠ€è¡“">
    
    <!-- React å’Œ Babel -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const EmbeddingVisualizer = () => {
          const [activeTab, setActiveTab] = useState('embedding');
          const [rotation, setRotation] = useState({ x: 20, y: 45 });
          const [zoom, setZoom] = useState(1);
          const [isDragging, setIsDragging] = useState(false);
          const [dragStart, setDragStart] = useState({ x: 0, y: 0 });
          const canvasRef = useRef(null);

          // Embedding ç¤ºä¾‹æ•¸æ“š
          const embeddingData = [
            { id: 1, x: 100, y: 100, z: 100, label: 'è²“', color: '#3B82F6' },
            { id: 2, x: 120, y: 110, z: 95, label: 'ğŸ±', color: '#60A5FA' },
            { id: 3, x: 90, y: 150, z: 120, label: 'ç‹—', color: '#3B82F6' },
            { id: 4, x: 110, y: 160, z: 115, label: 'ğŸ•', color: '#60A5FA' },
            { id: 5, x: -80, y: -70, z: 80, label: 'è˜‹æœ', color: '#EF4444' },
            { id: 6, x: -90, y: -60, z: 85, label: 'ğŸ', color: '#F87171' },
            { id: 7, x: -70, y: -90, z: 70, label: 'é¦™è•‰', color: '#EF4444' },
            { id: 8, x: -75, y: -80, z: 75, label: 'ğŸŒ', color: '#F87171' },
            { id: 9, x: -100, y: 120, z: -90, label: 'æ±½è»Š', color: '#10B981' },
            { id: 10, x: -110, y: 130, z: -85, label: 'ğŸš—', color: '#34D399' },
            { id: 11, x: -90, y: 140, z: -100, label: 'é£›æ©Ÿ', color: '#10B981' },
            { id: 12, x: -95, y: 150, z: -95, label: 'âœˆï¸', color: '#34D399' },
          ];

          // CLIP æœå°‹æ•¸æ“š
          const clipData = [
            { x: 0, y: 0, z: 0, label: 'æŸ¥è©¢: å¯æ„›çš„å°è²“', type: 'query', color: '#FBBF24' },
            { x: 30, y: 25, z: 20, label: 'ğŸ±', similarity: 0.95, color: '#22C55E' },
            { x: 80, y: -40, z: 30, label: 'ğŸ•', similarity: 0.72, color: '#EAB308' },
            { x: -60, y: 50, z: -40, label: 'ğŸ¦Š', similarity: 0.68, color: '#EAB308' },
            { x: -90, y: -80, z: 60, label: 'ğŸ', similarity: 0.15, color: '#EF4444' },
            { x: 100, y: 90, z: -70, label: 'ğŸš—', similarity: 0.08, color: '#EF4444' },
          ];

          const project3D = (x, y, z, rotX, rotY, canvasWidth = 600, canvasHeight = 500) => {
            const radX = (rotX * Math.PI) / 180;
            const radY = (rotY * Math.PI) / 180;
            
            let tempX = x * Math.cos(radY) + z * Math.sin(radY);
            let tempZ = -x * Math.sin(radY) + z * Math.cos(radY);
            let finalY = y * Math.cos(radX) - tempZ * Math.sin(radX);
            let finalZ = y * Math.sin(radX) + tempZ * Math.cos(radX);
            
            const perspective = 500 / (500 + finalZ);
            
            return {
              x: tempX * perspective * 3 * zoom + canvasWidth / 2,
              y: finalY * perspective * 3 * zoom + canvasHeight / 2,
              scale: perspective * zoom,
              z: finalZ
            };
          };

          useEffect(() => {
            const canvas = canvasRef.current;
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // è¨­å®šé«˜ DPI é¡¯ç¤º
            const dpr = window.devicePixelRatio || 2;
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);
            
            // å•Ÿç”¨é«˜å“è³ªæ¸²æŸ“
            ctx.imageSmoothingEnabled = true;
            ctx.imageSmoothingQuality = 'high';
            
            const displayWidth = rect.width;
            const displayHeight = rect.height;
            
            ctx.clearRect(0, 0, displayWidth, displayHeight);
            
            // èƒŒæ™¯ç¶²æ ¼
            ctx.strokeStyle = '#374151';
            ctx.lineWidth = 0.5;
            for (let i = -200; i <= 200; i += 50) {
              const p1 = project3D(i, -150, -200, rotation.x, rotation.y, displayWidth, displayHeight);
              const p2 = project3D(i, -150, 200, rotation.x, rotation.y, displayWidth, displayHeight);
              ctx.beginPath();
              ctx.moveTo(p1.x, p1.y);
              ctx.lineTo(p2.x, p2.y);
              ctx.stroke();
            }
            
            // åº§æ¨™è»¸
            const origin = project3D(0, 0, 0, rotation.x, rotation.y, displayWidth, displayHeight);
            const axes = [
              { end: project3D(150, 0, 0, rotation.x, rotation.y, displayWidth, displayHeight), color: '#EF4444', label: 'X' },
              { end: project3D(0, 150, 0, rotation.x, rotation.y, displayWidth, displayHeight), color: '#22C55E', label: 'Y' },
              { end: project3D(0, 0, 150, rotation.x, rotation.y, displayWidth, displayHeight), color: '#3B82F6', label: 'Z' },
            ];
            
            axes.forEach(axis => {
              ctx.strokeStyle = axis.color;
              ctx.lineWidth = 2.5;
              ctx.beginPath();
              ctx.moveTo(origin.x, origin.y);
              ctx.lineTo(axis.end.x, axis.end.y);
              ctx.stroke();
              ctx.fillStyle = axis.color;
              ctx.font = 'bold 16px sans-serif';
              ctx.fillText(axis.label, axis.end.x + 10, axis.end.y);
            });
            
            // ç¹ªè£½é»
            const data = activeTab === 'embedding' ? embeddingData : clipData;
            const sorted = [...data].sort((a, b) => {
              const aZ = project3D(a.x, a.y, a.z, rotation.x, rotation.y, displayWidth, displayHeight).z;
              const bZ = project3D(b.x, b.y, b.z, rotation.x, rotation.y, displayWidth, displayHeight).z;
              return bZ - aZ;
            });
            
            sorted.forEach(point => {
              const proj = project3D(point.x, point.y, point.z, rotation.x, rotation.y, displayWidth, displayHeight);
              const size = (point.type === 'query' ? 20 : 12) * proj.scale;
              
              // CLIP é€£ç·š
              if (activeTab === 'clip' && point.type !== 'query') {
                const queryProj = project3D(0, 0, 0, rotation.x, rotation.y, displayWidth, displayHeight);
                ctx.strokeStyle = point.color;
                ctx.lineWidth = 2.5;
                ctx.globalAlpha = 0.3;
                ctx.beginPath();
                ctx.moveTo(queryProj.x, queryProj.y);
                ctx.lineTo(proj.x, proj.y);
                ctx.stroke();
                ctx.globalAlpha = 1;
              }
              
              // ç¹ªè£½é»
              ctx.fillStyle = point.color;
              ctx.beginPath();
              ctx.arc(proj.x, proj.y, size, 0, Math.PI * 2);
              ctx.fill();
              
              if (point.type === 'query') {
                ctx.strokeStyle = '#FFF';
                ctx.lineWidth = 3.5;
                ctx.stroke();
              }
              
              // æ¨™ç±¤ - é«˜å“è³ªæ–‡å­—æ¸²æŸ“
              ctx.fillStyle = '#FFF';
              ctx.font = `bold ${16 * proj.scale}px -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif`;
              ctx.textAlign = 'center';
              ctx.textBaseline = 'middle';
              
              // æ–‡å­—é™°å½±æé«˜å¯è®€æ€§
              ctx.shadowColor = 'rgba(0, 0, 0, 0.8)';
              ctx.shadowBlur = 4;
              ctx.shadowOffsetX = 0;
              ctx.shadowOffsetY = 0;
              
              ctx.fillText(point.label, proj.x, proj.y - size - 8);
              
              if (point.similarity !== undefined) {
                ctx.font = `600 ${13 * proj.scale}px -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif`;
                ctx.fillText(`${(point.similarity * 100).toFixed(0)}%`, proj.x, proj.y + size + 18);
              }
              
              // é‡ç½®é™°å½±
              ctx.shadowColor = 'transparent';
              ctx.shadowBlur = 0;
            });
          }, [rotation, activeTab, zoom]);

          const handleMouseDown = (e) => {
            setIsDragging(true);
            setDragStart({ x: e.clientX, y: e.clientY });
          };

          const handleMouseMove = (e) => {
            if (!isDragging) return;
            const deltaX = e.clientX - dragStart.x;
            const deltaY = e.clientY - dragStart.y;
            setRotation(prev => ({
              x: Math.max(-90, Math.min(90, prev.x + deltaY * 0.5)),
              y: prev.y + deltaX * 0.5
            }));
            setDragStart({ x: e.clientX, y: e.clientY });
          };

          const handleMouseUp = () => setIsDragging(false);

          const zoomIn = () => setZoom(prev => Math.min(3, prev * 1.2));
          const zoomOut = () => setZoom(prev => Math.max(0.3, prev / 1.2));
          
          const resetView = () => {
            setRotation({ x: 20, y: 45 });
            setZoom(1);
          };

          useEffect(() => {
            if (isDragging) {
              window.addEventListener('mousemove', handleMouseMove);
              window.addEventListener('mouseup', handleMouseUp);
              return () => {
                window.removeEventListener('mousemove', handleMouseMove);
                window.removeEventListener('mouseup', handleMouseUp);
              };
            }
          }, [isDragging, dragStart]);

          return (
            <div className="min-h-screen bg-gradient-to-br from-gray-900 via-blue-900 to-purple-900 p-8">
              <div className="max-w-6xl mx-auto">
                <h1 className="text-4xl font-bold text-white mb-2 text-center">
                  Embedding & CLIP è¦–è¦ºåŒ–
                </h1>
                <p className="text-blue-200 text-center mb-8">
                  ç”¨ 3D ç©ºé–“ç†è§£èªæ„å‘é‡å’Œåœ–åƒæª¢ç´¢
                </p>

                <div className="flex gap-4 mb-6">
                  <button
                    onClick={() => setActiveTab('embedding')}
                    className={`flex-1 py-3 px-6 rounded-lg font-semibold transition-all ${
                      activeTab === 'embedding'
                        ? 'bg-blue-600 text-white shadow-lg'
                        : 'bg-gray-700 text-gray-300 hover:bg-gray-600'
                    }`}
                  >
                    âš¡ Embedding ç©ºé–“
                  </button>
                  <button
                    onClick={() => setActiveTab('clip')}
                    className={`flex-1 py-3 px-6 rounded-lg font-semibold transition-all ${
                      activeTab === 'clip'
                        ? 'bg-purple-600 text-white shadow-lg'
                        : 'bg-gray-700 text-gray-300 hover:bg-gray-600'
                    }`}
                  >
                    ğŸ” CLIP åœ–åƒæœå°‹
                  </button>
                </div>

                <div className="bg-gray-800 rounded-lg shadow-2xl p-6 mb-6">
                  <div className="flex justify-between items-center mb-4 flex-wrap gap-3">
                    <h2 className="text-xl font-bold text-white">
                      {activeTab === 'embedding' ? 'èªæ„å‘é‡ç©ºé–“' : 'CLIP ç›¸ä¼¼åº¦ç©ºé–“'}
                    </h2>
                    <div className="flex items-center gap-3 flex-wrap">
                      <div className="text-sm text-gray-400">
                        ğŸ–±ï¸ æ‹–æ›³æ—‹è½‰
                      </div>
                      <div className="flex items-center gap-2 bg-gray-700 px-3 py-2 rounded-lg">
                        <button
                          onClick={zoomOut}
                          className="w-8 h-8 bg-gray-600 hover:bg-gray-500 text-white rounded font-bold text-lg transition-colors"
                          title="ç¸®å°"
                        >
                          âˆ’
                        </button>
                        <span className="text-white text-sm font-semibold min-w-[60px] text-center">
                          {zoom.toFixed(1)}x
                        </span>
                        <button
                          onClick={zoomIn}
                          className="w-8 h-8 bg-gray-600 hover:bg-gray-500 text-white rounded font-bold text-lg transition-colors"
                          title="æ”¾å¤§"
                        >
                          +
                        </button>
                      </div>
                      <button
                        onClick={resetView}
                        className="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-semibold transition-colors"
                      >
                        ğŸ”„ é‡ç½®è¦–è§’
                      </button>
                    </div>
                  </div>
                  
                  <canvas
                    ref={canvasRef}
                    style={{ width: '100%', height: '500px' }}
                    onMouseDown={handleMouseDown}
                    className="bg-gray-900 rounded cursor-move"
                  />
                </div>

                <div className="grid md:grid-cols-2 gap-6">
                  {activeTab === 'embedding' ? (
                    <>
                      <div className="bg-gray-800 rounded-lg p-6">
                        <div className="flex items-center mb-3">
                          <span className="text-2xl mr-2">ğŸ“</span>
                          <h3 className="text-lg font-bold text-white">ä»€éº¼æ˜¯ Embeddingï¼Ÿ</h3>
                        </div>
                        <p className="text-gray-300 mb-4">
                          Embedding æ˜¯å°‡æ–‡å­—ã€åœ–åƒç­‰è³‡æ–™è½‰æ›æˆæ•¸å­¸å‘é‡çš„æŠ€è¡“ã€‚ç›¸ä¼¼çš„æ¦‚å¿µåœ¨ç©ºé–“ä¸­æœƒé è¿‘ã€‚
                        </p>
                        <ul className="space-y-2 text-sm text-gray-400">
                          <li className="flex items-start">
                            <span className="text-blue-400 mr-2">â€¢</span>
                            <span>è—è‰²é»ï¼šæ–‡å­— embeddingï¼ˆå¦‚ã€Œè²“ã€ã€ã€Œç‹—ã€ï¼‰</span>
                          </li>
                          <li className="flex items-start">
                            <span className="text-blue-300 mr-2">â€¢</span>
                            <span>æ·ºè—é»ï¼šåœ–åƒ embeddingï¼ˆå°æ‡‰çš„åœ–ç‰‡ï¼‰</span>
                          </li>
                          <li className="flex items-start">
                            <span className="text-yellow-400 mr-2">â€¢</span>
                            <span>ç›¸ä¼¼ç‰©é«”æœƒèšé›†åœ¨ä¸€èµ·å½¢æˆç¾¤é›†</span>
                          </li>
                        </ul>
                      </div>

                      <div className="bg-gray-800 rounded-lg p-6">
                        <div className="flex items-center mb-3">
                          <span className="text-2xl mr-2">âš¡</span>
                          <h3 className="text-lg font-bold text-white">é—œéµæ¦‚å¿µ</h3>
                        </div>
                        <div className="space-y-3 text-sm">
                          <div className="bg-gray-700 p-3 rounded">
                            <div className="font-semibold text-green-400 mb-1">èªæ„ç›¸ä¼¼åº¦</div>
                            <div className="text-gray-300">
                              ç©ºé–“ä¸­çš„è·é›¢ä»£è¡¨èªæ„çš„ç›¸ä¼¼ç¨‹åº¦ã€‚è²“å’Œç‹—å¾ˆæ¥è¿‘ï¼Œè²“å’Œæ±½è»Šå¾ˆé ã€‚
                            </div>
                          </div>
                          <div className="bg-gray-700 p-3 rounded">
                            <div className="font-semibold text-blue-400 mb-1">å¤šæ¨¡æ…‹èåˆ</div>
                            <div className="text-gray-300">
                              æ–‡å­—å’Œåœ–åƒå¯ä»¥åœ¨åŒä¸€ç©ºé–“ä¸­è¡¨ç¤ºï¼Œå¯¦ç¾è·¨æ¨¡æ…‹ç†è§£ã€‚
                            </div>
                          </div>
                        </div>
                      </div>
                    </>
                  ) : (
                    <>
                      <div className="bg-gray-800 rounded-lg p-6">
                        <div className="flex items-center mb-3">
                          <span className="text-2xl mr-2">ğŸ–¼ï¸</span>
                          <h3 className="text-lg font-bold text-white">ä»€éº¼æ˜¯ CLIPï¼Ÿ</h3>
                        </div>
                        <p className="text-gray-300 mb-4">
                          CLIP èƒ½ç”¨æ–‡å­—æœå°‹åœ–åƒï¼Œé€šéæ¸¬é‡å‘é‡é–“çš„ç›¸ä¼¼åº¦æ‰¾åˆ°æœ€åŒ¹é…çš„çµæœã€‚
                        </p>
                        <ul className="space-y-2 text-sm text-gray-400">
                          <li className="flex items-start">
                            <span className="text-yellow-400 mr-2">â­</span>
                            <span>ä¸­å¿ƒé»ƒé»ï¼šä½ çš„æ–‡å­—æŸ¥è©¢</span>
                          </li>
                          <li className="flex items-start">
                            <span className="text-green-400 mr-2">ğŸŸ¢</span>
                            <span>ç¶ è‰²ï¼šé«˜ç›¸ä¼¼åº¦çµæœï¼ˆ&gt;80%ï¼‰</span>
                          </li>
                          <li className="flex items-start">
                            <span className="text-red-400 mr-2">ğŸ”´</span>
                            <span>ç´…è‰²ï¼šä½ç›¸ä¼¼åº¦çµæœï¼ˆ&lt;20%ï¼‰</span>
                          </li>
                        </ul>
                      </div>

                      <div className="bg-gray-800 rounded-lg p-6">
                        <div className="flex items-center mb-3">
                          <span className="text-2xl mr-2">ğŸ“¸</span>
                          <h3 className="text-lg font-bold text-white">å¯¦éš›æ‡‰ç”¨</h3>
                        </div>
                        <div className="space-y-3 text-sm">
                          <div className="bg-gray-700 p-3 rounded">
                            <div className="font-semibold text-purple-400 mb-1">åœ–åƒæœå°‹</div>
                            <div className="text-gray-300">
                              è¼¸å…¥ã€Œæ—¥è½æµ·ç˜ã€ï¼Œè‡ªå‹•æ‰¾å‡ºæ‰€æœ‰ç›¸é—œç…§ç‰‡
                            </div>
                          </div>
                          <div className="bg-gray-700 p-3 rounded">
                            <div className="font-semibold text-pink-400 mb-1">å…§å®¹å¯©æ ¸</div>
                            <div className="text-gray-300">
                              æª¢æ¸¬åœ–ç‰‡æ˜¯å¦åŒ…å«ç‰¹å®šå…§å®¹æˆ–é•è¦å…ƒç´ 
                            </div>
                          </div>
                          <div className="bg-gray-700 p-3 rounded">
                            <div className="font-semibold text-blue-400 mb-1">é›¶æ¨£æœ¬åˆ†é¡</div>
                            <div className="text-gray-300">
                              ä¸éœ€è¨“ç·´å°±èƒ½åˆ†é¡å¾æœªè¦‹éçš„ç‰©é«”é¡åˆ¥
                            </div>
                          </div>
                        </div>
                      </div>
                    </>
                  )}
                </div>

                <div className="mt-6 bg-gray-800 rounded-lg p-6">
                  <h3 className="text-lg font-bold text-white mb-3">ğŸ’¡ æŠ€è¡“åŸç†</h3>
                  <div className="grid md:grid-cols-3 gap-4 text-sm">
                    <div className="bg-gray-700 p-4 rounded">
                      <div className="font-semibold text-blue-400 mb-2">1. å‘é‡åŒ–</div>
                      <div className="text-gray-300">
                        å°‡æ–‡å­—/åœ–åƒè½‰æ›æˆå›ºå®šç¶­åº¦çš„æ•¸å€¼å‘é‡ï¼ˆå¦‚ 512 ç¶­ï¼‰
                      </div>
                    </div>
                    <div className="bg-gray-700 p-4 rounded">
                      <div className="font-semibold text-green-400 mb-2">2. ç›¸ä¼¼åº¦è¨ˆç®—</div>
                      <div className="text-gray-300">
                        ä½¿ç”¨é¤˜å¼¦ç›¸ä¼¼åº¦æˆ–æ­å¼è·é›¢æ¸¬é‡å‘é‡é–“çš„æ¥è¿‘ç¨‹åº¦
                      </div>
                    </div>
                    <div className="bg-gray-700 p-4 rounded">
                      <div className="font-semibold text-purple-400 mb-2">3. æ’åºæª¢ç´¢</div>
                      <div className="text-gray-300">
                        æ ¹æ“šç›¸ä¼¼åº¦åˆ†æ•¸æ’åºï¼Œè¿”å›æœ€ç›¸é—œçš„çµæœ
                      </div>
                    </div>
                  </div>
                </div>

                <footer className="mt-8 text-center text-gray-400 text-sm">
                  <p>äº’å‹•å¼ 3D è¦–è¦ºåŒ–æ•™å­¸å·¥å…· - ç†è§£ AI çš„èªæ„ç©ºé–“</p>
                </footer>
              </div>
            </div>
          );
        };

        // æ¸²æŸ“æ‡‰ç”¨
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<EmbeddingVisualizer />);
    </script>
</body>
</html>